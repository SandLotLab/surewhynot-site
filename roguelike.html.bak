<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Roguelike | surewhynot.app</title>

  <!-- SEO -->
  <meta name="description" content="Play a lightweight top-down roguelike in your browser. Procedural dungeon generation, permadeath-style runs, and keyboard controls." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://surewhynot.app/roguelike.html" />
  <meta property="og:title" content="Roguelike | surewhynot.app" />
  <meta property="og:description" content="A procedural top-down roguelike built in vanilla HTML5 Canvas." />
  <meta property="og:type" content="website" />

  <!-- Basic Hardening -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 script-src 'self' https://pagead2.googlesyndication.com https://www.googletagservices.com;
                 connect-src 'self';
                 img-src 'self' data: https:;
                 style-src 'self' 'unsafe-inline';
                 object-src 'none';
                 base-uri 'none';
                 frame-ancestors 'none';
                 upgrade-insecure-requests;">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

  <!-- Google AdSense -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7167291111213614"
    crossorigin="anonymous"></script>

  <style>
    :root { color-scheme: dark; }
    body {
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      background:#0b0f14;
      color:#e6edf3;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
    }
    .wrap { width:min(980px,96vw); }
    header { display:flex; justify-content:space-between; align-items:center; padding:10px 0; }
    canvas {
      width:100%;
      height:auto;
      border:1px solid #1f2630;
      border-radius:12px;
      background:#070a0e;
      display:block;
    }
    .card {
      border:1px solid #1f2630;
      background:#0f1620;
      border-radius:14px;
      padding:14px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
    }
    .hud {
      display:flex;
      justify-content:space-between;
      margin-top:8px;
      font-size:12px;
      opacity:.85;
      flex-wrap:wrap;
    }
  </style>
</head>

<body>
<div class="wrap">
  <header>
    <div><b>Roguelike</b> <span id="seedShort" style="opacity:.6;font-size:12px;"></span></div>
    <div class="hud" style="margin:0;">
      <div>Move: WASD / Arrows</div>
      <div>New run: R</div>
    </div>
  </header>

  <div class="card">
    <canvas id="game" width="768" height="512"></canvas>
    <div class="hud">
      <div>Status: <span id="status">Alive</span></div>
      <div>Seed: <span id="seedFull"></span></div>
    </div>

    <!-- Ad Placement -->
    <ins class="adsbygoogle"
         style="display:block;margin-top:12px"
         data-ad-client="ca-pub-7167291111213614"
         data-ad-slot="auto"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
</div>

<script>
"use strict";

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d", { alpha:false });
const statusEl = document.getElementById("status");
const seedShort = document.getElementById("seedShort");
const seedFull = document.getElementById("seedFull");

const TILE=16;
const W=Math.floor(canvas.width/TILE);
const H=Math.floor(canvas.height/TILE);
const WALL=0,FLOOR=1;

let seed,rng,map,player;

function makeSeed(){
  return "run-"+Math.random().toString(16).slice(2)+"-"+Date.now().toString(16);
}
function hash32(str){
  let h=0x811c9dc5;
  for(let i=0;i<str.length;i++){
    h^=str.charCodeAt(i);
    h=Math.imul(h,0x01000193);
  }
  return h>>>0;
}
function mulberry32(a){
  return function(){
    let t=(a+=0x6d2b79f5);
    t=Math.imul(t^(t>>>15),t|1);
    t^=t+Math.imul(t^(t>>>7),t|61);
    return((t^(t>>>14))>>>0)/4294967296;
  };
}
function randi(min,max){return Math.floor(rng()*(max-min+1))+min;}
function clamp(v,l,h){return Math.max(l,Math.min(h,v));}

function newRun(){
  seed=makeSeed();
  rng=mulberry32(hash32(seed));
  seedShort.textContent=seed.slice(0,20)+"â€¦";
  seedFull.textContent=seed;
  statusEl.textContent="Alive";
  map=makeMap(W,H);
  player=placePlayer();
  draw();
}

function makeMap(w,h){
  const g=Array.from({length:h},()=>Array.from({length:w},()=>WALL));
  const rooms=[];
  for(let i=0;i<18;i++){
    const rw=randi(4,12),rh=randi(4,10);
    const rx=randi(1,w-rw-2),ry=randi(1,h-rh-2);
    const room={x:rx,y:ry,w:rw,h:rh,cx:rx+(rw>>1),cy:ry+(rh>>1)};
    let ok=true;
    for(const r of rooms){
      if(room.x<r.x+r.w+1&&room.x+room.w+1>r.x&&
         room.y<r.y+r.h+1&&room.y+room.h+1>r.y){ok=false;break;}
    }
    if(!ok)continue;
    for(let y=room.y;y<room.y+room.h;y++)
      for(let x=room.x;x<room.x+room.w;x++)
        g[y][x]=FLOOR;
    if(rooms.length)connect(g,rooms[rooms.length-1],room);
    rooms.push(room);
  }
  if(!rooms.length)
    for(let y=2;y<h-2;y++)
      for(let x=2;x<w-2;x++)
        g[y][x]=FLOOR;
  return g;
}

function connect(g,a,b){
  let x=a.cx,y=a.cy;
  while(x!==b.cx){x+=x<b.cx?1:-1;g[y][x]=FLOOR;}
  while(y!==b.cy){y+=y<b.cy?1:-1;g[y][x]=FLOOR;}
}

function placePlayer(){
  for(let i=0;i<5000;i++){
    const x=randi(1,W-2),y=randi(1,H-2);
    if(map[y][x]===FLOOR)return{x,y};
  }
  map[2][2]=FLOOR;
  return{x:2,y:2};
}

function tryMove(dx,dy){
  const nx=clamp(player.x+dx,0,W-1);
  const ny=clamp(player.y+dy,0,H-1);
  if(map[ny][nx]===FLOOR){player.x=nx;player.y=ny;draw();}
}

function draw(){
  ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let y=0;y<H;y++){
    for(let x=0;x<W;x++){
      ctx.fillStyle=map[y][x]===WALL?"#0a0f16":"#121b26";
      ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
    }
  }
  ctx.fillStyle="#e6edf3";
  ctx.fillRect(player.x*TILE+3,player.y*TILE+3,TILE-6,TILE-6);
}

addEventListener("keydown",e=>{
  const k=e.key.toLowerCase();
  if(k==="arrowup"||k==="w"){e.preventDefault();tryMove(0,-1);}
  else if(k==="arrowdown"||k==="s"){e.preventDefault();tryMove(0,1);}
  else if(k==="arrowleft"||k==="a"){e.preventDefault();tryMove(-1,0);}
  else if(k==="arrowright"||k==="d"){e.preventDefault();tryMove(1,0);}
  else if(k==="r"){e.preventDefault();newRun();}
});

newRun();
</script>
</body>
</html>
